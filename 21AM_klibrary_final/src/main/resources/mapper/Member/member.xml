<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">
	<select id="selectMember" resultMap="MemberT">
		SELECT * FROM MEMBER WHERE USER_ID=#{userId} AND USER_PASSWORD=#{userPassword}
	</select>
	
	<update id="updateMember">
		UPDATE MEMBER SET USER_PASSWORD=#{userPassword},
						  PHONE=#{phone},
						  BIRTH_DATE=#{birthDate},
						  ADDRESS=#{address},
						  EMAIL=#{email}
		WHERE USER_ID=#{userId}
	</update>
	
	<resultMap type="com.kh.klibrary.member.model.vo.MemberT" id="MemberT">
		<result column="USER_ID" property="userId"/>
		<result column="USER_PASSWORD" property="userPassword"/>
		<result column="USER_NAME" property="userName"/>
		<result column="EMAIL" property="email"/>
		<result column="BIRTH_DATE" property="birthDate"/>
		<result column="ADDRESS" property="address"/>
		<result column="PHONE" property="phone"/>
		<result column="SIGNUP_DATE" property="signupDate"/>
	</resultMap>
	
	<select id="selectLHList" resultMap="LH">
		SELECT * FROM LENDING_HISTORY WHERE USER_ID=#{userId} ORDER BY LENDING_HISTORY_NO DESC
	</select>
	
	<resultMap type="com.kh.klibrary.member.model.vo.LendingHistory" id="LH">
		<result column="LENDING_HISTORY_NO" property="lendingHistroyNo"/>
		<result column="LENDING_NO" property="lendingNo"/>
		<result column="USER_ID" property="userId"/>
		<result column="BOOK_NO" property="bookNo"/>
		<result column="LENDING_DATE" property="lendingDate"/>
		<result column="RETURN_DATE" property="returnDate"/>
		<result column="BOOK_EXTEND" property="bookExtend"/>
	</resultMap>
	
	<select id="selectLendingList" resultMap="lending">
		SELECT * FROM
		LENDING LEFT JOIN (SELECT * FROM BOOK LEFT JOIN BOOK_INFO USING(ISBN_NO)) USING(BOOK_NO)
		WHERE USER_ID=#{userId}
	</select>
	
	<resultMap type="com.kh.klibrary.member.model.vo.Lending" id="lending">
		<id column="LENDING_NO" property="lendingNo"/>
		<result column="USER_ID" property="userId"/>
		<result column="BOOK_NO" property="bookNo"/>
		<result column="LENDING_DATE" property="lendingDate"/>
		<result column="RETURN_DATE" property="returnDate"/>
		<result column="BOOK_EXTEND" property="bookExtend"/>
		<collection property="memberT" ofType="memberT">
			<id column="USER_ID" property="userId"/>
			<result column="USER_PASSWORD" property="userPassword"/>
			<result column="USER_NAME" property="userName"/>
			<result column="EMAIL" property="email"/>
			<result column="BIRTH_DATE" property="birthDate"/>
			<result column="ADDRESS" property="address"/>
			<result column="PHONE" property="phone"/>
			<result column="SIGNUP_DATE" property="signupDate"/>
		</collection>
		<collection property="book" ofType="book">
			<id column="BOOK_NO" property="bookNo"/>
			<result column="ISBN_NO" property="bookingState"/>
			<result column="BOOKING_STATE" property="bookingState"/>
			<result column="LENDING_STATE" property="lendingState"/>
			<collection property="bookInfo" ofType="bookInfo">
				<id column="ISBN_NO" property="isbnNo"/>
				<result column="BOOK_NAME" property="bookName"/>
				<result column="BOOK_WRITER" property="bookWriter"/>
				<result column="BOOK_COMPANY" property="bookCompany"/>
				<result column="BOOK_DATE" property="bookDate"/>
				<result column="BOOK_PRICE" property="bookPrice"/>
				<result column="BOOK_LOCATION" property="bookLocation"/>
				<result column="BOOK_CONTENT" property="bookContent"/>
				<result column="BOOK_IMG" property="bookImg"/>
				<result column="BOOK_KDC" property="bookKdc"/>
			</collection>
		</collection>
	</resultMap>
</mapper>
